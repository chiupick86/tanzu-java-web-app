accelerator:
  displayName: Tanzu Java Web App
  description: A sample Spring Boot web application built with Tanzu supply-chain
  iconUrl: https://raw.githubusercontent.com/sample-accelerators/icons/master/icon-cloud.png
  tags:
  - main-branch
  - java
  - spring
  - web
  - tanzu

  # options for the UI
  options:
  - name: workloadName
    label: "The Name of the Workload"
    inputType: text
    display: true
    defaultValue: ""
    required: true

  # Java Version
  - name: javaVersion 
    inputType: select 
    display: true 
    defaultValue: value-2 
    choices:
      - text: 16
        value: '16'
      - text: 17
        value: '17'
      - text: 18
        value: '18'

# Readiness & Liviness Version
  - name: stateNess 
    label: "Do you need Self-HealthCheck for the Application?"
    inputType: checkbox
    dataType: boolean
    defaultValue: false
    
#   - name: dependsOnCheckbox
#     label: 'depends on checkbox'
#     description: Self Health Check . 
#     dependsOn:
#       name: stateNess
#       value: true 
#     defaultValue: false

#   - name: radio 
#     inputType: radio 
#     display: true 
#     defaultValue: value-2 
#     choices:
#       - text: Radio choice 1 
#         value: value-1
#       - text: Radio choice 2 
#         value: value-2
#       - text: Radio choice 3 
#         value: value-3

engine:
  merge:
    - include: [ "**" ]
#     - type: InvokeFragment
#       reference: java-version
    - include: [ "**" ]
      exclude: [ "pom.xml", "config/**", "README.md"]
#     - include: [ "pom.xml" ]
#       chain:
#       - type: ReplaceText
#         substitutions:
#         - text: tanzu-java-web-app
#           with: "#workloadName"
#     - include: [ "config/workload.yaml" ]
#       chain:
#       - type: ReplaceText
#         substitutions:
#         - text: tanzu-java-web-app
#           with: "#workloadName"
    - include: [ "catalog-info.yaml", "config/**" ]
      chain:
      - type: ReplaceText
        substitutions:
        - text: tanzu-java-web-app
          with: "#workloadName"

    # Java Version      
    - include: [ "config/workload.yaml" ]
      chain:
      - type: ReplaceText
        condition: "#javaVersion == '17'"
        substitutions:
          - text: "spec:"
            with: "'spec:\n  build:\n    env:\n    - name: BP_JVM_VERSION\n      value: \"17\"'"
            
    # ReadiNess & liveNess         
    - include: [ "config/workload.yaml" ]
      chain:
      - type: ReplaceText
        condition: "#stateNess == true"
        substitutions:
          - text: "params:"
            with: "'params:\n  - name: livenessProbe\n    value:\n      httpGet:\n        path: \"/livez\"\n        port: \"8082\"\n      initialDelaySeconds: \"5\"\n      timeoutSeconds: \"1\"\n  - name: readinessProbe\n    value:\n      httpGet:\n        path: \"/readyz\"\n        port: \"8082\"\n      initialDelaySeconds: \"5\"\n      timeoutSeconds: \"1\"\n'"
            
